<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="DrugUtilisation">
<title>Use DrugUtilisation to create cohort • DrugUtilisation</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use DrugUtilisation to create cohort">
<meta property="og:description" content="DrugUtilisation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DrugUtilisation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Intro_create_cohort.html">Use DrugUtilisation to create cohort</a>
    <a class="dropdown-item" href="../articles/addIndications-example.html">Add indications to Drug Utilisation Cohort</a>
    <a class="dropdown-item" href="../articles/my-vignette.html">my-vignette</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Use DrugUtilisation to create cohort</h1>
                        <h4 data-toc-skip class="author">Marti Catala,
Mike Du, Yuchen Guo, Kim Lopez-Guell, Edward Burn, Xintong Li</h4>
            
      
      
      <div class="d-none name"><code>Intro_create_cohort.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="create-mock-data-first">Create mock data first<a class="anchor" aria-label="anchor" href="#create-mock-data-first"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/DrugUtilisation/">DrugUtilisation</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CodelistGenerator/" class="external-link">CodelistGenerator</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/duckdb/man/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">":memory:"</span><span class="op">)</span></span>
<span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  con <span class="op">=</span> <span class="va">con</span>,</span>
<span>  writeSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cdmPrefix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  writePrefix <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mockDrugUtilisation.html">mockDrugUtilisation</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  numberIndividual <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-concept-code-for-cohort-generation">Get concept code for cohort generation<a class="anchor" aria-label="anchor" href="#get-concept-code-for-cohort-generation"></a>
</h2>
<p>To generate a cohort, we will need a concept list, this can be
obtained through different ways.</p>
<ol style="list-style-type: decimal">
<li>Get from json file.</li>
<li>Use concept code directly.</li>
<li>Get ingredient</li>
<li>Get ATC code</li>
</ol>
<p>To get it from json file, both function readConceptList() and
codesFromConceptSet() can be used.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get concept from json file using readConceptList from this package or CodelistGenerator</span></span>
<span><span class="va">conceptSet_json_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readConceptList.html">readConceptList</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"inst/Concept"</span><span class="op">)</span>, <span class="va">cdm</span><span class="op">)</span></span>
<span><span class="va">conceptSet_json_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/codesFromConceptSet.html" class="external-link">codesFromConceptSet</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"inst/Concept"</span><span class="op">)</span>, <span class="va">cdm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conceptSet_json_1</span></span>
<span><span class="co">#&gt; $asthma</span></span>
<span><span class="co">#&gt; [1] 317009</span></span>
<span><span class="va">conceptSet_json_2</span></span>
<span><span class="co">#&gt; $asthma</span></span>
<span><span class="co">#&gt; [1] 317009</span></span></code></pre></div>
<p>Or a list can be created manually with the target codes:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get concept using code directly</span></span>
<span><span class="va">conceptSet_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>asthma <span class="op">=</span> <span class="fl">317009</span><span class="op">)</span></span>
<span><span class="va">conceptSet_code</span></span>
<span><span class="co">#&gt; $asthma</span></span>
<span><span class="co">#&gt; [1] 317009</span></span></code></pre></div>
<p>If there is a certain ingredient of interest, code can also be
obtained by getDrugIngredientCodes() from CodelistGenerator.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get concept by ingredient</span></span>
<span><span class="va">conceptSet_ingredient</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getDrugIngredientCodes.html" class="external-link">getDrugIngredientCodes</a></span><span class="op">(</span><span class="va">cdm</span>, name <span class="op">=</span> <span class="st">"simvastatin"</span><span class="op">)</span></span>
<span><span class="va">conceptSet_ingredient</span></span>
<span><span class="co">#&gt; $simvastatin</span></span>
<span><span class="co">#&gt; [1] 1539403 1539462 1539463</span></span></code></pre></div>
<p>ATC code can also be obtained, using getATCCodes() from
CodelistGenerator.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get concept from ATC codes</span></span>
<span><span class="va">conceptSet_ATC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CodelistGenerator/reference/getATCCodes.html" class="external-link">getATCCodes</a></span><span class="op">(</span><span class="va">cdm</span>, </span>
<span>                              level <span class="op">=</span> <span class="st">"ATC 1st"</span>, </span>
<span>                              name <span class="op">=</span> <span class="st">"ALIMENTARY TRACT AND METABOLISM"</span><span class="op">)</span></span>
<span><span class="va">conceptSet_ATC</span></span>
<span><span class="co">#&gt; $alimentary_tract_and_metabolism</span></span>
<span><span class="co">#&gt; [1] 35897399</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-cohort">Create cohort<a class="anchor" aria-label="anchor" href="#create-cohort"></a>
</h2>
<p>Now having the conceptSet, we can proceed to generate cohort. There
are two functions in this package to generate cohort:</p>
<ol style="list-style-type: decimal">
<li>generateConceptCohortSet: to generate a cohort for a certain list of
concepts, which does not have to be drug. This function is exported from
CDMConnector</li>
<li>generateDrugUtilisationCohortSet: to generate a cohort of the drug
use</li>
</ol>
<div class="section level3">
<h3 id="generateconceptcohortset">generateConceptCohortSet()<a class="anchor" aria-label="anchor" href="#generateconceptcohortset"></a>
</h3>
<p>First, let’s use generateConceptCohortSet to get the asthma cohort
using the <em>conceptSet_code</em>, it will also give the same output if
changed to <em>conceptSet_json_1</em> or <em>conceptSet_json_2</em>, as
they are using the same concept code.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/generateConceptCohortSet.html" class="external-link">generateConceptCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  conceptSet <span class="op">=</span> <span class="va">conceptSet_code</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"asthma_1"</span>,</span>
<span>  end <span class="op">=</span> <span class="st">"observation_period_end_date"</span>,</span>
<span>  requiredObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm1</span><span class="op">$</span><span class="va">asthma_1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;main.asthma_1&gt; [2 x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB 0.8.1 [unknown@Linux 6.2.0-1012-azure:R 4.3.1/:memory:]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1         10 2022-03-24        2022-03-30     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1          2 2018-11-05        2018-11-15</span></span></code></pre></div>
<p>The count of the cohort can be assessed using cohortCount() from
CDMConnector</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm1</span><span class="op">$</span><span class="va">asthma_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1              2               2</span></span></code></pre></div>
<p>Cohort attrition can be assessed using cohortAttrition() from
CDMConnector</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortAttrition.html" class="external-link">cohortAttrition</a></span><span class="op">(</span><span class="va">cdm1</span><span class="op">$</span><span class="va">asthma_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1              2               2         1 Qualifying init…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;dbl&gt;, excluded_subjects &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The <em>end</em> parameter set how the cohort end date is defined.
Now it is changed to event end date to demonstrate the difference from
previous observation period end date. See that now the cohort_end_date
is different:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/generateConceptCohortSet.html" class="external-link">generateConceptCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  conceptSet <span class="op">=</span> <span class="va">conceptSet_code</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"asthma_2"</span>,</span>
<span>  end <span class="op">=</span> <span class="st">"event_end_date"</span>,</span>
<span>  requiredObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm1</span><span class="op">$</span><span class="va">asthma_2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;main.asthma_2&gt; [2 x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB 0.8.1 [unknown@Linux 6.2.0-1012-azure:R 4.3.1/:memory:]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1         10 2022-03-24        2022-03-26     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1          2 2018-11-05        2018-11-10</span></span></code></pre></div>
<p>The <em>requiredObservation</em> parameter is a numeric vector of
length 2, that defines the number of days of required observation time
prior to index and post index for an event to be included in the cohort.
Let’s check it now to see how reducing required observation affect the
<em>asthma_1</em> cohort.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/generateConceptCohortSet.html" class="external-link">generateConceptCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  conceptSet <span class="op">=</span> <span class="va">conceptSet_code</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"asthma_3"</span>,</span>
<span>  end <span class="op">=</span> <span class="st">"observation_period_end_date"</span>,</span>
<span>  requiredObservation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm1</span><span class="op">$</span><span class="va">asthma_3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;main.asthma_3&gt; [0 x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB 0.8.1 [unknown@Linux 6.2.0-1012-azure:R 4.3.1/:memory:]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 variables: cohort_definition_id &lt;int&gt;, subject_id &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   cohort_start_date &lt;date&gt;, cohort_end_date &lt;date&gt;</span></span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm1</span><span class="op">$</span><span class="va">asthma_3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1              0               0</span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortAttrition.html" class="external-link">cohortAttrition</a></span><span class="op">(</span><span class="va">cdm1</span><span class="op">$</span><span class="va">asthma_3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1              0               0         1 Qualifying init…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;dbl&gt;, excluded_subjects &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generatedrugutilisationcohortset">generateDrugUtilisationCohortSet()<a class="anchor" aria-label="anchor" href="#generatedrugutilisationcohortset"></a>
</h3>
<p>Now let’s try function
DrugUtilisation::generateDrugUtilisationCohortSet() to get the drug
cohort for ingredient simvastatin. This function has a lot more options
you can set. We first use default settings:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"dus_alleras"</span>,</span>
<span>  conceptSetList <span class="op">=</span> <span class="va">conceptSet_ingredient</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm2</span><span class="op">$</span><span class="va">dus_alleras</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;main.dus_alleras&gt; [?? x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB 0.8.1 [unknown@Linux 6.2.0-1012-azure:R 4.3.1/:memory:]</span></span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                    1         57 2020-09-14        2020-11-26     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                    1         89 2018-08-26        2018-11-02     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                    1         29 2020-10-11        2021-02-07     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                    1         21 1995-07-02        2002-05-12     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                    1        100 2022-10-20        2022-10-24     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                    1         27 2019-02-26        2020-06-10     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                    1         57 2020-06-19        2020-08-21     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                    1         77 1966-12-10        1967-02-03     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                    1         80 2022-08-31        2022-09-07     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                    1         84 2010-08-15        2017-05-13     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm2</span><span class="op">$</span><span class="va">dus_alleras</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1             53              48</span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortAttrition.html" class="external-link">cohortAttrition</a></span><span class="op">(</span><span class="va">cdm2</span><span class="op">$</span><span class="va">dus_alleras</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">number_records</span>, <span class="va">reason</span>, <span class="va">excluded_records</span>, <span class="va">excluded_subjects</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   number_records reason                       excluded_records excluded_subjects</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>             58 <span style="color: #949494;">"</span>Qualifying initial records<span style="color: #949494;">"</span>                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>             58 <span style="color: #949494;">"</span>Duration imputation; affec…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>             53 <span style="color: #949494;">"</span>Join eras<span style="color: #949494;">"</span>                                 5                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>             53 <span style="color: #949494;">"</span>prior use wahout of 0 days<span style="color: #949494;">"</span>                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>             53 <span style="color: #949494;">"</span>at least 0 prior observati…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>             53 <span style="color: #949494;">"</span>cohort_start_date &gt;= NA<span style="color: #949494;">"</span>                   0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>             53 <span style="color: #949494;">"</span>cohort_end_date &lt;= NA<span style="color: #949494;">"</span>                     0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>             53 <span style="color: #949494;">"</span>limit: all applied<span style="color: #949494;">"</span>                        0                 0</span></span></code></pre></div>
<div class="section level4">
<h4 id="imputeduration-and-durationrange">imputeDuration and durationRange<a class="anchor" aria-label="anchor" href="#imputeduration-and-durationrange"></a>
</h4>
<p>The parameter <em>durationRange</em> specifies the range within which
the duration must fall, where duration = end date - start date + 1.
Default as c(1, Inf). It should be a numeric vector of length two, with
no NAs and the first value should be equal or smaller than the second
one. Duration values outside of <em>durationRange</em> will be imputed
using <em>imputeDuration</em>. It can ne set as: “none”, “median”,
“mean”, “mode” or an integer (count).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"dus_step2_0_inf"</span>,</span>
<span>  conceptSetList <span class="op">=</span> <span class="va">conceptSet_ingredient</span>,</span>
<span>  imputeDuration <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  durationRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span> <span class="co"># default as c(1, Inf)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortAttrition.html" class="external-link">cohortAttrition</a></span><span class="op">(</span><span class="va">cdm3</span><span class="op">$</span><span class="va">dus_step2_0_inf</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">number_records</span>, <span class="va">reason</span>, <span class="va">excluded_records</span>, <span class="va">excluded_subjects</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   number_records reason                       excluded_records excluded_subjects</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>             58 <span style="color: #949494;">"</span>Qualifying initial records<span style="color: #949494;">"</span>                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>             58 <span style="color: #949494;">"</span>Duration imputation; affec…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>             53 <span style="color: #949494;">"</span>Join eras<span style="color: #949494;">"</span>                                 5                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>             53 <span style="color: #949494;">"</span>prior use wahout of 0 days<span style="color: #949494;">"</span>                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>             53 <span style="color: #949494;">"</span>at least 0 prior observati…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>             53 <span style="color: #949494;">"</span>cohort_start_date &gt;= NA<span style="color: #949494;">"</span>                   0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>             53 <span style="color: #949494;">"</span>cohort_end_date &lt;= NA<span style="color: #949494;">"</span>                     0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>             53 <span style="color: #949494;">"</span>limit: all applied<span style="color: #949494;">"</span>                        0                 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="gapera">gapEra<a class="anchor" aria-label="anchor" href="#gapera"></a>
</h4>
<p>The <em>gapEra</em> parameter defines the number of days between two
continuous drug exposures to be considered as a same era. Now let’s
change it from 0 to a larger number. From the <em>dus_step3_alleras</em>
cohort attrition, we can see that when joining era at <strong>STEP
3</strong>, it resulted in less records, compared to the
<em>dus_step2_0_inf</em> cohort, as exposures with less than 30 days
gaps are joined.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"dus_step3_alleras"</span>,</span>
<span>  conceptSetList <span class="op">=</span> <span class="va">conceptSet_ingredient</span>,</span>
<span>  imputeDuration <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  durationRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  gapEra <span class="op">=</span> <span class="fl">30</span> <span class="co"># default as 0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortAttrition.html" class="external-link">cohortAttrition</a></span><span class="op">(</span><span class="va">cdm4</span><span class="op">$</span><span class="va">dus_step3_alleras</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">number_records</span>, <span class="va">reason</span>, <span class="va">excluded_records</span>, <span class="va">excluded_subjects</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   number_records reason                       excluded_records excluded_subjects</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>             58 <span style="color: #949494;">"</span>Qualifying initial records<span style="color: #949494;">"</span>                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>             58 <span style="color: #949494;">"</span>Duration imputation; affec…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>             51 <span style="color: #949494;">"</span>Join eras<span style="color: #949494;">"</span>                                 7                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>             51 <span style="color: #949494;">"</span>prior use wahout of 0 days<span style="color: #949494;">"</span>                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>             51 <span style="color: #949494;">"</span>at least 0 prior observati…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>             51 <span style="color: #949494;">"</span>cohort_start_date &gt;= NA<span style="color: #949494;">"</span>                   0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>             51 <span style="color: #949494;">"</span>cohort_end_date &lt;= NA<span style="color: #949494;">"</span>                     0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>             51 <span style="color: #949494;">"</span>limit: all applied<span style="color: #949494;">"</span>                        0                 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="priorusewashout">priorUseWashout<a class="anchor" aria-label="anchor" href="#priorusewashout"></a>
</h4>
<p>The <em>priorUseWashout</em> parameter specifiesthe number of prior
days without exposure (often termed a ‘washout’) that are required. By
default, it is set to NULL, meaning no washout period is necessary. In
the example provided, we observe a reduction in the number of records in
<strong>STEP 4</strong> for cohort <em>dus_alleras_step4</em> due to the
washout period required, compared to the <em>dus_step3_alleras</em>
cohort.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"dus_alleras_step4"</span>,</span>
<span>  conceptSetList <span class="op">=</span> <span class="va">conceptSet_ingredient</span>,</span>
<span>  imputeDuration <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  durationRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  gapEra <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  priorUseWashout <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortAttrition.html" class="external-link">cohortAttrition</a></span><span class="op">(</span><span class="va">cdm5</span><span class="op">$</span><span class="va">dus_alleras_step4</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">number_records</span>, <span class="va">reason</span>, <span class="va">excluded_records</span>, <span class="va">excluded_subjects</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   number_records reason                       excluded_records excluded_subjects</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>             58 <span style="color: #949494;">"</span>Qualifying initial records<span style="color: #949494;">"</span>                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>             58 <span style="color: #949494;">"</span>Duration imputation; affec…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>             51 <span style="color: #949494;">"</span>Join eras<span style="color: #949494;">"</span>                                 7                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>             51 <span style="color: #949494;">"</span>prior use wahout of 30 day…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>             51 <span style="color: #949494;">"</span>at least 0 prior observati…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>             51 <span style="color: #949494;">"</span>cohort_start_date &gt;= NA<span style="color: #949494;">"</span>                   0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>             51 <span style="color: #949494;">"</span>cohort_end_date &lt;= NA<span style="color: #949494;">"</span>                     0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>             51 <span style="color: #949494;">"</span>limit: all applied<span style="color: #949494;">"</span>                        0                 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="priorobservation">priorObservation<a class="anchor" aria-label="anchor" href="#priorobservation"></a>
</h4>
<p>The parameter <em>priorObservation</em> defines the minimum number of
days of prior observation necessary for drug eras to be taken into
account. If set to NULL, the drug eras are not required to fall within
the observation_period. In this example, there is a noticeable decrease
in the number of records for <em>dus_alleras_step5</em> cohort in
<strong>STEP 5</strong> when compared to the <em>dus_alleras_step4</em>
cohort.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"dus_alleras_step5"</span>,</span>
<span>  conceptSetList <span class="op">=</span> <span class="va">conceptSet_ingredient</span>,</span>
<span>  imputeDuration <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  durationRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  gapEra <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  priorUseWashout <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  priorObservation <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortAttrition.html" class="external-link">cohortAttrition</a></span><span class="op">(</span><span class="va">cdm6</span><span class="op">$</span><span class="va">dus_alleras_step5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">number_records</span>, <span class="va">reason</span>, <span class="va">excluded_records</span>, <span class="va">excluded_subjects</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   number_records reason                       excluded_records excluded_subjects</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>             58 <span style="color: #949494;">"</span>Qualifying initial records<span style="color: #949494;">"</span>                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>             58 <span style="color: #949494;">"</span>Duration imputation; affec…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>             51 <span style="color: #949494;">"</span>Join eras<span style="color: #949494;">"</span>                                 7                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>             51 <span style="color: #949494;">"</span>prior use wahout of 30 day…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>             48 <span style="color: #949494;">"</span>at least 30 prior observat…                3                 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>             48 <span style="color: #949494;">"</span>cohort_start_date &gt;= NA<span style="color: #949494;">"</span>                   0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>             48 <span style="color: #949494;">"</span>cohort_end_date &lt;= NA<span style="color: #949494;">"</span>                     0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>             48 <span style="color: #949494;">"</span>limit: all applied<span style="color: #949494;">"</span>                        0                 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cohortdaterange">cohortDateRange<a class="anchor" aria-label="anchor" href="#cohortdaterange"></a>
</h4>
<p>The <em>cohortDateRange</em> parameter defines the range for the
cohort_start_date and cohort_end_date. In the following example, one can
observe a reduction in <strong>STEP 6</strong> and <strong>STEP
7</strong> due to the constraints imposed on the cohort start and end
dates.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"dus_alleras_step67"</span>,</span>
<span>  conceptSetList <span class="op">=</span> <span class="va">conceptSet_ingredient</span>,</span>
<span>  imputeDuration <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  durationRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  gapEra <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  priorUseWashout <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  priorObservation <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2010-01-01"</span>, <span class="st">"2011-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  limi <span class="op">=</span> <span class="st">"All"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortAttrition.html" class="external-link">cohortAttrition</a></span><span class="op">(</span><span class="va">cdm7</span><span class="op">$</span><span class="va">dus_alleras_step67</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">number_records</span>, <span class="va">reason</span>, <span class="va">excluded_records</span>, <span class="va">excluded_subjects</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   number_records reason                       excluded_records excluded_subjects</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>             58 <span style="color: #949494;">"</span>Qualifying initial records<span style="color: #949494;">"</span>                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>             58 <span style="color: #949494;">"</span>Duration imputation; affec…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>             51 <span style="color: #949494;">"</span>Join eras<span style="color: #949494;">"</span>                                 7                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>             51 <span style="color: #949494;">"</span>prior use wahout of 30 day…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>             48 <span style="color: #949494;">"</span>at least 30 prior observat…                3                 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>             34 <span style="color: #949494;">"</span>cohort_start_date &gt;= 2010-…               14                14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>              4 <span style="color: #949494;">"</span>cohort_end_date &lt;= 2011-01…               30                28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>              4 <span style="color: #949494;">"</span>limit: All applied<span style="color: #949494;">"</span>                        0                 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="limit-first-era-that-fulfills-the-criteria">limit: First era that fulfills the criteria<a class="anchor" aria-label="anchor" href="#limit-first-era-that-fulfills-the-criteria"></a>
</h4>
<p>Change the <em>limit</em> parameter from <em>All</em> to
<em>First</em> and observe how it impacts the attrition of the
<em>dus_step8_firstera cohort</em> in comparison to the
<em>dus_alleras_step67</em> cohort. The number of records decreased at
<strong>STEP 8</strong> because of the <em>First</em> limit. It gets the
first record that fulfills all criteria.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"dus_step8_firstera"</span>,</span>
<span>  conceptSetList <span class="op">=</span> <span class="va">conceptSet_ingredient</span>,</span>
<span>  imputeDuration <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  durationRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  gapEra <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  priorUseWashout <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  priorObservation <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2010-01-01"</span>, <span class="st">"2011-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  limit <span class="op">=</span> <span class="st">"First"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cohortAttrition.html" class="external-link">cohortAttrition</a></span><span class="op">(</span><span class="va">cdm8</span><span class="op">$</span><span class="va">dus_step8_firstera</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">number_records</span>, <span class="va">reason</span>, <span class="va">excluded_records</span>, <span class="va">excluded_subjects</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   number_records reason                       excluded_records excluded_subjects</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>             58 <span style="color: #949494;">"</span>Qualifying initial records<span style="color: #949494;">"</span>                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>             58 <span style="color: #949494;">"</span>Duration imputation; affec…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>             51 <span style="color: #949494;">"</span>Join eras<span style="color: #949494;">"</span>                                 7                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>             51 <span style="color: #949494;">"</span>prior use wahout of 30 day…                0                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>             48 <span style="color: #949494;">"</span>at least 30 prior observat…                3                 2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>             34 <span style="color: #949494;">"</span>cohort_start_date &gt;= 2010-…               14                14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>              4 <span style="color: #949494;">"</span>cohort_end_date &lt;= 2011-01…               30                28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>              4 <span style="color: #949494;">"</span>limit: First applied<span style="color: #949494;">"</span>                      0                 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="limit-first-ever-era">limit: First ever era<a class="anchor" aria-label="anchor" href="#limit-first-ever-era"></a>
</h4>
<p>The parameter <em>limit</em> only allows <em>All</em> and
<em>First</em>. The <em>First</em> value represents the first era that
meets the criteria set by the parameters prior to <em>limit</em>.
However, if the goal is to get the first-ever era, this can be achieved
using this function too. Setting the following parameter will result in
the first ever drug era:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateDrugUtilisationCohortSet.html">generateDrugUtilisationCohortSet</a></span><span class="op">(</span><span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"dus_step8_firstever"</span>,</span>
<span>  conceptSetList <span class="op">=</span> <span class="va">conceptSet_ingredient</span>,</span>
<span>  imputeDuration <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  durationRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  gapEra <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  priorUseWashout <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  priorObservation <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  limit <span class="op">=</span> <span class="st">"First"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Constructing concept sets and generating various cohorts are the
initial steps in conducting a drug utilization study. For further
guidance on using getting more information like characteristics from
these cohorts, please refer to the other vignettes.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marti Catala, Mike Du, Yuchen Guo, Kim Lopez-Guell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
